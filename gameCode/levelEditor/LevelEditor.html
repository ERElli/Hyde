<body style="margin:0px">
  <canvas id="background" width="496" height="310"  style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
  <canvas id="levelground" width="496" height="310"  style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
  <canvas id="foreground" width="496" height="310" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>
  <canvas id="grid" width="496" height="310" style="position: absolute; left:0; top: 0; z-index: 3;"></canvas>
</body>
<script type="text/javascript" src="Rectangle.js"></script>
<script>

var bg = document.getElementById("background");
var lg = document.getElementById("levelground");
var fg = document.getElementById("foreground");
var gr = document.getElementById("grid");

var ctx_bg = bg.getContext("2d");

var ctx_lg = lg.getContext("2d");
var ctx_fg = fg.getContext("2d");
var ctx_gr = gr.getContext("2d");

ctx_fg.globalAlpha = 0.3;

var TILE_HEIGHT = 31;
var TILE_WIDTH = 31;
var WIDTH = 496;
var HEIGHT = 310;
var timeWhenGameStarted = Date.now();	//return time in ms
var frameCount = 0;
var rectWIDTH = 31*2;
var rectHEIGHT = 31*2;

var backgroundImage = new Image();
backgroundImage.src = "../../images/levelEditorBackground.png";

var enemyButtonImage = new Image();
enemyButtonImage.src = "../../images/enemiesButton.png";

var musicButtonImage = new Image();
musicButtonImage.src = "../../images/musicButton.png";

var backgroundButtonImage = new Image();
backgroundButtonImage.src = "../../images/backgroundButton.png";

var checkPointButtonImage = new Image();
checkPointButtonImage.src = "../../images/checkPointButton.png";

var characterButtonImage = new Image();
characterButtonImage.src = "../../images/characterButton.png";

var terrainButtonImage = new Image();
terrainButtonImage.src = "../../images/terrainButton.png";

var weaponButtonImage = new Image();
weaponButtonImage.src = "../../images/weaponButton.png";









Rectangle.list = {};

snapToGrid  = function(canvas,mouse){
	var pos = getMousePosition(canvas,mouse);
	var x = pos.x - (pos.x % TILE_HEIGHT);
	var y = pos.y - (pos.y % TILE_WIDTH);
	ctx_fg.fillStyle="#A4A4A4";
	ctx_fg.fillRect(x, y, rectWIDTH, rectHEIGHT);
	return {
		x: x,
		y: y,
	};
}

document.onmousemove = function(mouse){
	var pos = getMousePosition(fg,mouse);
	ctx_fg.clearRect(0,0,WIDTH,HEIGHT);
	snapToGrid(fg,mouse);
}


getMousePosition = function(canvas,mouse){
	var rect = canvas.getBoundingClientRect();
	return {
		x: mouse.clientX - rect.left,
		y: mouse.clientY - rect.top,
	};
}

document.onmousedown = function(mouse){
	var pos = getMousePosition(bg,mouse);
	var id = Math.random();
	var x = pos.x - (pos.x % TILE_HEIGHT);
	var y = pos.y - (pos.y % TILE_WIDTH);

	var mouseBelowUpperBound = pos.x<WIDTH && pos.y<HEIGHT;
	var mouseAboveLowerBound = pos.x>0 && pos.y>0;

	if(mouseBelowUpperBound && mouseAboveLowerBound){
		if(((x+rectWIDTH) <= WIDTH) && ((y+rectHEIGHT) <= HEIGHT)){
			console.log(pos);
			console.log(x);
			console.log(y);
			Rectangle(id,x,y,rectWIDTH,rectHEIGHT);
		}
		else{
			console.log("Can not place object there");
		}
	}
}




	


drawGrid = function(){
	ctx_gr.globalAlpha = 0.05;
	ctx_gr.lineWidth = 2;
	ctx_gr.strokeStyle = "#ABABAB";
	//Drawing vertical lines
	for(x=TILE_WIDTH; x<=WIDTH; x+=TILE_WIDTH){
		ctx_gr.moveTo(x,0);
		ctx_gr.lineTo(x,HEIGHT);
		ctx_gr.stroke();
	}

	//Drawing horizontal lines
	for(y=TILE_HEIGHT; y<=HEIGHT; y+=TILE_HEIGHT){
		ctx_gr.moveTo(0,y);
		ctx_gr.lineTo(WIDTH,y);
		ctx_gr.stroke();
	}
}



update = function() {
	ctx_bg.drawImage(backgroundImage, 0, 0);
	
	ctx_bg.drawImage(enemyButtonImage, 31, 0);
	ctx_bg.drawImage(musicButtonImage, 93, 0);
	ctx_bg.drawImage(backgroundButtonImage, 155, 0);
	ctx_bg.drawImage(checkPointButtonImage, 218, 0);
	ctx_bg.drawImage(characterButtonImage, 281, 0);
	ctx_bg.drawImage(terrainButtonImage, 344, 0);
	ctx_bg.drawImage(weaponButtonImage, 406, 0);
	Rectangle.update();

}




drawGrid();
setInterval(update, 1000/20);



init = function() {
	var container = document.getElementById("container");
	
}

</script>
<body onload = "init()">
	<div id="container"></div>
	<div id="messages"></div>
</body>