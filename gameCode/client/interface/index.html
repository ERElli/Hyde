<html>
		
	<body>
		<br>
		<br>
		<div id="menu">
			<a href='../gameMenu.html'>Quit</a>
		</div>
		
		<div id="container">
		
			<div id="results" style="positions:absolute; left: 511px;">
				<table style="border:1px"></table>
			</div>
			
		</div>
		
	</body>
	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
		<script type="text/javascript" src="../engine/main.js"></script>
		<script type="text/javascript" src="../engine/entity.js"></script>
		<script type="text/javascript" src="../engine/player.js"></script>
		<script type="text/javascript" src="../engine/enemy.js"></script>
		<script type="text/javascript" src="../engine/weapon.js"></script>
		<script type="text/javascript" src="../engine/usable.js"></script>
		<script type="text/javascript" src="../../levelEditor/EntityFactory.js"></script>

		<script type="text/javascript" src="level.json"></script>
		<script type="text/javascript" src="jsonTest.js"></script>

		<script type="text/javascript" src="../../levelEditor/Terrain.js"></script>
		<script type="text/javascript" src="images.js"></script>
		<script type="text/javascript" src="sounds.js"></script>
		<script type="text/javascript" src="GUI.js"></script>
		<script type="text/javascript" src="Animation.js"></script>
		

		<script>

		
		var socket = io();

		//call the socket to get the level objects from database
		var  getLevelObjects = function() {
			socket.emit('getLevelObject', {levelName: "level 1"});
		};

		var levelObjects;
		getLevelObjects();



		//the socket receive the level objects from the database

		socket.on('receiveLevelObjects',function(data){
			levelObjects = data;
			//level objects should be in data, right now they are logged in console
			console.log(JSON.parse(levelObjects));
			let realLevel = EntityFactory(levelObjects,false);
			console.log("REAL LEVEL",realLevel);


			var level = {};
			var p;

			for (var thing in realLevel['player']) {
				p = realLevel['player'][thing]
			}

			level['player'] = new Player(p.id, p.x, p.y-100, p.vx, p.vy, p.img, new Pistol(Math.random(), p.x, p.y, p.vx, p.vy, 50, 50,"pistol_image",null, p.id), p.isBig);
			console.log("REAL LEVEL@@",realLevel);

			level['enemies'] = {};

			for (let thing in realLevel['enemies']) {
				e = realLevel['enemies'][thing]

				var enemy;

				if (e.type == 'basic enemy') {
					enemy =  new BasicEnemy(e.id, e.x, e.y-100, e.vx, e.vy, e.img, null, level['player']);
				}
				else if (e.type == 'tank enemy') {
					enemy =  new TankEnemy(e.id, e.x, e.y-100, e.vx, e.vy, e.img, null, level['player']);
				}
				else {
					enemy =  new FlyingEnemy(e.id, e.x, e.y-100, e.vx, e.vy, e.img, null, level['player']);
				}

				level['enemies'][e.id] = enemy;

			}
			
			level['weapons'] = {};
			
			console.log("Weap: " + realLevel['weapons']);

			for (let thing in realLevel['weapons']) {
				console.log("HERE: " + realLevel['weapons'][thing]);
				w = realLevel['weapons'][thing]

				var weapon;

				weapon = new WeaponPickUp(w.id, w.x, w.y, w.weaponType, level['player']);

				level['weapons'][w.id] = weapon;

			}
			
			level['terrain'] = {};
			for (var thing in realLevel['terrain']) {
				let t = realLevel['terrain'][thing]
				console.log(t.type);

				var block;

				if (t.type == 'Terrain1x1') {
					block = Terrain1x1(t.id, t.x, t.y-100);
				}else if (t.type == 'Terrain3x2Breakable') {
					block = Terrain3x2(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain1x1Breakable') {
					block = Terrain1x1Breakable(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain3x2') {
					block = Terrain3x2(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain3x2Breakable') {
					block = Terrain3x2Breakable(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain3x4') {
					block = Terrain3x4(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain3x4Breakable') {
					block = Terrain3x4Breakable(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain3x6') {
					block = Terrain3x6(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain3x6Breakable') {
					block = Terrain3x6Breakable(t.id, t.x, t.y-100);
				}
				else if (t.type == 'Terrain1x6Breakable') {
					block = Terrain1x6Breakable(t.id, t.x, t.y-100);
				}
				

				level['terrain'][t.id] = block;
				//console.log(level['terrain']);

			}

			level.width = realLevel.width;
			console.log(realLevel.width);
			
			startGame(level);
	  });


		/*
			socket.on('receiveLevelObjects',function(data){
			levelObjects = data;

				//level objects should be in data, right now they are logged in console
				console.log("ddd"+ levelObjects[0].enemies);
				Update(levelObjects);
			});


			function Update(level){

				var levelFromFactory = EntityFactory(level,false);
			}
			*/

		//



		let gameWidth=2000
		// construct the gui with the container and the map
		var gui;
		var ani=Animation();
		var Img=Img("../../");
		var Sound = Sound("../../");
		var HEIGHT=500;
		var WIDTH=1250;

		//-----------
		init = function() {
			// get a reference to the container div in the page
			var container = document.getElementById("container");
			document.getElementById("results").position = 'absolute';
			document.getElementById("results").style.left = container.width + 20;
			gui=GUI(container);
			gui.createCanvas(WIDTH,HEIGHT);
		}
		//Creates background and foreground Canvases
		init();


		for (var id in levelObjects.player) {
			levelObjects.player = levelObjects.player[id]
		}


		for (var id in levelFromFactory.enemies) {
			//console.log(levelFromFactory.enemies[id]);
			levelFromFactory.enemies[id].target = levelFromFactory.player;
		}

		//startGame(levelObjects);



		//console.log(mydata);

//#############################################################################	
	//FOR GUI TESTING PURPOSES	
	/*

		var level = {}

		for (var thing in mydata['player']) {
			p = mydata['player'][thing]
		}

		level['player'] = new Player(p.id, p.x, p.y, p.vx, p.vy, p.img, new Pistol(Math.random(), p.x, p.y, p.vx, p.vy, 50, 50,"pistol_image",null, p.id), p.isBig);


		level['enemies'] = {}

		for (var thing in mydata['enemies']) {
			e = mydata['enemies'][thing]

			var enemy;

			if (e.type == 'basic enemy') {
				enemy =  new BasicEnemy(e.id, e.x, e.y, e.vx, e.vy, e.img, null, level['player']);
			}
			else if (e.type == 'tank enemy') {
				enemy =  new TankEnemy(e.id, e.x, e.y, e.vx, e.vy, e.img, null, level['player']);
			}
			else {
				enemy =  new FlyingEnemy(e.id, e.x, e.y, e.vx, e.vy, e.img, null, level['player']);
			}

			level['enemies'][e.id] = enemy;

		}


		level['terrain'] = {}

		for (var thing in mydata['terrain']) {
			t = mydata['terrain'][thing]
			console.log(t.type);

			var block;

			if (t.type == 'Terrain1x1') {
				block = Terrain1x1(t.id, t.x, t.y);
			}


			level['terrain'][t.id] = block;
			//console.log(level['terrain']);

		}

		console.log("BEFORE SOCKET",mydata);


		startGame(level);
		*/
//######################################################################################

		</script>
</html>
